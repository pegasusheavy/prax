#!/bin/sh
#
# Pre-commit hook: Format and lint checks
# Runs before each commit to ensure code quality
#

set -e

echo "üîç Running pre-commit checks..."

# Check if cargo is available
if ! command -v cargo &> /dev/null; then
    echo "‚ùå cargo not found. Please install Rust."
    exit 1
fi

# Format check
echo "üìù Checking formatting..."
if ! cargo fmt --all -- --check; then
    echo ""
    echo "‚ùå Formatting issues found!"
    echo "   Run 'cargo fmt --all' to fix them."
    exit 1
fi
echo "‚úÖ Formatting OK"

# Clippy lints
echo "üìé Running Clippy..."
if ! cargo clippy --all-targets --all-features -- -D warnings; then
    echo ""
    echo "‚ùå Clippy found issues!"
    echo "   Please fix the warnings above."
    exit 1
fi
echo "‚úÖ Clippy OK"

# Check for common issues in staged files
echo "üîé Checking for debug artifacts..."
if git diff --cached --name-only | xargs grep -l "dbg!" 2>/dev/null; then
    echo ""
    echo "‚ö†Ô∏è  Warning: Found 'dbg!' macro in staged files."
    echo "   Consider removing debug statements before committing."
fi

if git diff --cached --name-only | xargs grep -l "println!" 2>/dev/null | grep -v "examples/" | grep -v "tests/"; then
    echo ""
    echo "‚ö†Ô∏è  Warning: Found 'println!' in staged files (outside examples/tests)."
    echo "   Consider using proper logging instead."
fi

echo ""
echo "‚úÖ All pre-commit checks passed!"

